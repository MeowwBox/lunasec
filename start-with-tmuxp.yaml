session_name: LunaSec
windows:
- window_name: services
  layout: tiled
  panes:
    - shell_command:
      - cd js/sdks
      - npm run watch
    # Secure Frame CDN
    - shell_command:
      - cd js/sdks/packages/secure-frame-iframe
      - npm run watch

    - shell_command:
      - cd js/sdks/packages/secure-frame-iframe
      - npx http-server -a localhost -p 8000

    # Demo React App Front End
    - shell_command:
      - cd js/demo-apps/packages/react-front-end
      - npm run start

    # Demo Application Backend, comes up on 3001
    - shell_command:
      - cd js/demo-apps/packages/express-back-end
      - DEMO_NAME="dedicated-passport-express" SESSION_JWT_PUBLIC_KEY=$(cat ../../../../go/fixtures/secureframe/auth_provider.pub | base64 -w0) LUNASEC_SIGNING_KEY=$(cat ../../../../go/fixtures/secureframe/auth_provider_key | base64 -w0) yarn start:dev

    # Tokenizer Back End.  Command uses docker compose to start localstack and run CDK deployment scripts against it before starting server locally
    - shell_command:
      - cd go
      - make secureframe
      - sudo COMPOSE_DOCKER_CLI_BUILD=1 DOCKER_BUILDKIT=1 docker-compose up -d local-dependencies && sleep 1 && env $(cat ../.env.host | xargs) ./build/secureframe_dev
